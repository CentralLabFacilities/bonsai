

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Skills &mdash; Bonsai Docs 2.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Bonsai Docs 2.0 documentation" href="../index.html"/>
        <link rel="up" title="Bonsai 2 - Bielefeld Sensor Actuator Interface" href="../bonsai.html"/>
        <link rel="prev" title="Memory Slots" href="memory.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Bonsai Docs
          

          
            
            <img src="../_static/bonsai-l1s.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">QuickStart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changes.html">Changes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../bonsai.html">Bonsai</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="coding-guideline.html">Coding Guideline</a></li>
<li class="toctree-l2"><a class="reference internal" href="scxml-intro.html">SCXML Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="general.html">General</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory.html">Memory</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Skills</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#skillparts">Skillparts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration">Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#void-configure-skillconfigurator">void configure(SkillConfigurator)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#methods">Methods</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#boolean-init">boolean init()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#exittoken-execute">ExitToken execute()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#exittoken-end-exittoken">ExitToken end(ExitToken)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Bonsai Docs</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../bonsai.html">Bonsai 2 - Bielefeld Sensor Actuator Interface</a> &raquo;</li>
      
    <li>Skills</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="skills">
<h1>Skills<a class="headerlink" href="#skills" title="Permalink to this headline">¶</a></h1>
<p>Skills are javaclasses, which mine the smallest parts of a statemachine. Each state of the statemachine is able to envoke an instance of a skill.
Combined skills are able to build more complex behaviours, which themselves can be represented as a single state.</p>
<div class="section" id="skillparts">
<h2>Skillparts<a class="headerlink" href="#skillparts" title="Permalink to this headline">¶</a></h2>
<p>Each skill extends AbstractSkill and needs some predefined components:</p>
<ul class="simple">
<li>Actuators that will be used</li>
<li>Sensors, which informations will be used</li>
<li>ExitTokens, that will be returned to the statemachine</li>
<li>datamodels and other variables you want to use</li>
</ul>
<p>The Skill methods gets invoked in the following order</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">configure</span> <span class="o">-&gt;</span> <span class="n">init</span> <span class="o">-&gt;</span> <span class="n">execute</span> <span class="o">-&gt;</span> <span class="n">end</span>
</pre></div>
</div>
<ul class="simple">
<li>The skill stops if configure throws an exception</li>
<li>if init return false the execute method is skipped, <code class="docutils literal notranslate"><span class="pre">end(Token.Fatal())</span></code> is then called</li>
<li>execute is able to loop until a non loop token is returned</li>
</ul>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<div class="section" id="void-configure-skillconfigurator">
<h3>void configure(SkillConfigurator)<a class="headerlink" href="#void-configure-skillconfigurator" title="Permalink to this headline">¶</a></h3>
<p>Configure is already called, when loading a statemachine, therefore errors can be handled before execution. Here you should handle your exit Tokens and the data get trough the statemachine</p>
<div class="section" id="actuators-and-sensors">
<h4>Actuators and Sensors<a class="headerlink" href="#actuators-and-sensors" title="Permalink to this headline">¶</a></h4>
<p>The usable Actuators and Sensors are usually defined in an bonsai config file and are usable as Javaobjects:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">ACTUATOR_SPEECHACTUATOR</span> <span class="o">=</span> <span class="s">&quot;SpeechActuator&quot;</span><span class="o">;</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">SENSOR_SPEECHSENSORCONFIRM</span> <span class="o">=</span> <span class="s">&quot;SpeechSensorConfirm&quot;</span><span class="o">;</span>

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">SkillConfigurator</span> <span class="n">configurator</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">speechSensor</span> <span class="o">=</span> <span class="n">configurator</span><span class="o">.</span><span class="na">getSensor</span><span class="o">(</span><span class="n">SENSOR_SPEECHSENSORCONFIRM</span><span class="o">,</span> <span class="n">Utterance</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">speechActuator</span> <span class="o">=</span> <span class="n">configurator</span><span class="o">.</span><span class="na">getActuator</span><span class="o">(</span><span class="n">ACTUATOR_SPEECHACTUATOR</span><span class="o">,</span> <span class="n">SpeechActuator</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="exittoken">
<h4>ExitToken<a class="headerlink" href="#exittoken" title="Permalink to this headline">¶</a></h4>
<p>ExitToken are used to create events after the skill is finished. To make sure all possible exit events are captured in the scxml the tokens have to be requested in the configuration method.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">SkillConfigurator</span> <span class="n">configurator</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// request all tokens that you plan to return from other methods</span>
    <span class="n">tokenSuccessPsYes</span> <span class="o">=</span> <span class="n">configurator</span><span class="o">.</span><span class="na">requestExitToken</span><span class="o">(</span><span class="n">ExitStatus</span><span class="o">.</span><span class="na">SUCCESS</span><span class="o">().</span><span class="na">withProcessingStatus</span><span class="o">(</span><span class="n">PS_YES</span><span class="o">));</span>
    <span class="n">tokenSuccessPsNo</span> <span class="o">=</span> <span class="n">configurator</span><span class="o">.</span><span class="na">requestExitToken</span><span class="o">(</span><span class="n">ExitStatus</span><span class="o">.</span><span class="na">SUCCESS</span><span class="o">().</span><span class="na">withProcessingStatus</span><span class="o">(</span><span class="n">PS_NO</span><span class="o">));</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="parameter">
<h4>Parameter<a class="headerlink" href="#parameter" title="Permalink to this headline">¶</a></h4>
<p>Skills are able to read parameter in the configure method</p>
<dl class="docutils">
<dt>::</dt>
<dd><p class="first">private String KEY_TEXT = “#_KEY”</p>
<dl class="docutils">
<dt>public void configure(SkillConfigurator configurator) {</dt>
<dd>text = configurator.requestValue(KEY_TEXT);
blocking = configurator.requestOptionalBool(KEY_BLOCKING, blocking);</dd>
</dl>
<p class="last">}</p>
</dd>
</dl>
<ul class="simple">
<li>there are different requestTYPE methods for different types <code class="docutils literal notranslate"><span class="pre">requestValue()</span></code> reads the value as String.</li>
<li>Requested parameter have to be given</li>
<li>You can request Optinal with defaults if the data with the supplied id is not found</li>
</ul>
<p>SCXML:
We have the option to read the local datamodel of the state that invokes the skill. Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;state</span> <span class="na">id=</span><span class="s">&quot;SomeSkill&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;datamodel&gt;</span>
        <span class="nt">&lt;data</span> <span class="na">id=</span><span class="s">&quot;#_KEY&quot;</span> <span class="na">expr=</span><span class="s">&quot;&#39;value&#39;&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/datamodel&gt;</span>
<span class="nt">&lt;/state&gt;</span>
</pre></div>
</div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="methods">
<h2>Methods<a class="headerlink" href="#methods" title="Permalink to this headline">¶</a></h2>
<div class="section" id="boolean-init">
<h3>boolean init()<a class="headerlink" href="#boolean-init" title="Permalink to this headline">¶</a></h3>
<p>Init initalizes the skill and should be used as a place to define your pre nonlogic structures.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">init</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">speechManager</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleSpeechHelper</span><span class="o">(</span><span class="n">speechSensor</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">timeout</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;using timeout of &quot;</span> <span class="o">+</span> <span class="n">timeout</span> <span class="o">+</span> <span class="s">&quot;ms&quot;</span><span class="o">);</span>
        <span class="n">timeout</span> <span class="o">+=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="n">speechManager</span><span class="o">.</span><span class="na">startListening</span><span class="o">();</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&quot;simple: &quot;</span> <span class="o">+</span> <span class="n">simpleYesOrNo</span><span class="o">);</span>
    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>

<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="exittoken-execute">
<h3>ExitToken execute()<a class="headerlink" href="#exittoken-execute" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">ExitToken</span> <span class="nf">execute</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">timeout</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">timeout</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;ConfirmYesOrNo timeout&quot;</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">tokenSuccessPsTimeout</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">simpleYesOrNo</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// call simple yes or no confirmation</span>
        <span class="k">return</span> <span class="n">simpleYesNo</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="c1">// call confirm yes or no with limited number of retries and</span>
        <span class="c1">// conformations from robot</span>
        <span class="k">return</span> <span class="n">confirmYesNo</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="exittoken-end-exittoken">
<h3>ExitToken end(ExitToken)<a class="headerlink" href="#exittoken-end-exittoken" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">ExitToken</span> <span class="nf">end</span><span class="o">(</span><span class="n">ExitToken</span> <span class="n">curToken</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">speechManager</span><span class="o">.</span><span class="na">removeHelper</span><span class="o">();</span>
    <span class="k">return</span> <span class="n">curToken</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="n">ExitToken</span> <span class="nf">simpleYesNo</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">speechManager</span><span class="o">.</span><span class="na">hasNewUnderstanding</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">ExitToken</span><span class="o">.</span><span class="na">loop</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">speechManager</span><span class="o">.</span><span class="na">getUnderstoodWords</span><span class="o">(</span><span class="n">NT_YES</span><span class="o">).</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">tokenSuccessPsYes</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(!</span><span class="n">speechManager</span><span class="o">.</span><span class="na">getUnderstoodWords</span><span class="o">(</span><span class="n">NT_NO</span><span class="o">).</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">tokenSuccessPsNo</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">ExitToken</span><span class="o">.</span><span class="na">loop</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="memory.html" class="btn btn-neutral" title="Memory Slots" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Leroy Rügemer.
      Last updated on Jun 26, 2018.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'2.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>